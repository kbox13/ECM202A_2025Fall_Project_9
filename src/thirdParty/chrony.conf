# ------------------------------------------------------
#  CHRONY NTP SERVER CONFIG FOR macOS LAPTOP
#  Works online and offline (stratum 10 local reference)
#  Serves ESP32 and local programs on LAN
# ------------------------------------------------------

# Use Apple's upstream server when online
pool time.apple.com iburst

# Allow local network clients (adjust subnet)
# Example: 192.168.0.0/24   or   10.0.0.0/24
allow 192.168.0.0/24
allow 172.20.0.0/16
allow 127.0.0.1

# Enable Linux-style logging directory
logdir /opt/homebrew/var/log/chrony

# Local reference clock (when the laptop has no internet)
# Stratum 10 keeps it clearly lower priority than real NTP
local stratum 10

# Record how far off-clock drift is
driftfile /opt/homebrew/var/lib/chrony/drift

# Make chrony serve time to clients
bindaddress 0.0.0.0
bindcmdaddress 127.0.0.1

# Save state on exit
dumponexit
dumpdir /opt/homebrew/var/lib/chrony

# Allow manual time stepping
makestep 1.0 3